<!DOCTYPE html>

<html lang="en">
<!-- Basic Needs -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


  
  <title>AK's Executive Dashboard</title>
  <meta name="description" content="">
  <meta name="author" content="AK">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="./favicon.ico">

 <!-- CSS -->
  <link rel="stylesheet" href="./css/font.css" type="text/css">
  <link rel="stylesheet" href="./css/normalize.css" type="text/css">
  <link rel="stylesheet" href="./css/skeleton.css" type="text/css">
<style type="text/css">
#mainContent
{
  margin-left: 60px;
}
h4
{
  padding-top: 10px;
}
 .dataTarget
 {
  height: 600px;
 } 

.dataBars
{
  /*margin: 0 auto 0 auto;*/
  position: relative;
}

.container
{
  text-align: center;
}

.filledBar
{
  width: 100%;
  height: 100px;
  position: absolute;
  bottom: 0px;
  right: 0px;
  display: inline;
  padding-top: 10px;
  z-index: -1; 
}

button
{
  z-index: 10;
  width: 240px;
  padding-left: 0px;
  padding-right: 0px;
  position: relative;
}

/* change padding-top to move bars */

#barOne
{

  background-color: #8484fc;
  transition: height 1.5s;

}

#barTwo
{
 background-color: #f95858; 
 margin-left: 0px;
 transition: height 2s;

}

#barThree
{
  background-color: #5dae5d;
 /* margin-left: 106px;
  width: 64%;*/
  transition: height 2.5s;

}

</style>
<!-- JS -->
<script src="./js/jquery.min.js"></script>
<script src="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.js"></script>
</head>


<!-- Content -->

<body>
  
    <div class="container u-full-width">
      <div class="row">
        <div class="twelve columns">
          <h4 class="hero-heading">Mixpanel Executive Dashboard</h4>
          </div>
        </div>

        <div class="row" id="mainContent">
        <div class="four columns dataBars">
        <button class="button-secondary dataTarget" id="DAU"><h2>XX</h2><br/>Daily Active Users
        <div id="barOne" class="filledBar"></div>
        </button>
         


        </div>

        <div class="four columns dataBars">
        <button class="button-secondary dataTarget" id="CONV"><h2>XX</h2><br/>Weekly Recommendation Rate
        <div id="barTwo" class="filledBar"></div>
        </button>
        
        </div>

        <div class="four columns dataBars">
        <button class="button-secondary dataTarget" id="SIGNUPS"><h2>XX</h2><br/>Signups This Week
        <div id="barThree" class="filledBar"></div>
        </button>
        </div>

        </div>

        <div class="row" id="emptySpace" style="height:30px;">
        </div>
  
          <a id="dataRefresh" class="button button-primary">Press me!</a>
          
      
    </div>

<!-- make the query -->
<script language="javascript">
function query1() {
    MP.api.jql(function main() {
        return Events({
                from_date: '2016-06-01',
                to_date: '2016-06-02'
            })
            
            //find 'active events'
            .filter(function(event) {
                return event.name === "Thumbs Up" || event.name ===
                    "Thumbs Down" || event.name ===
                    "Follow Sandwich"
            })
            
            //solve for 'unique users'
            .groupByUser(function(count, events) {
                count = count || 0;
                return count + events.length;
            })
            
            //sum the count of uniques across all events 
            .reduce(mixpanel.reducer.count())
            
            // summerize event names
            //.groupBy(['name'], mixpanel.reducer.count())
    }).done(function(results) {
       console.log('DAU query: '+results);
       return results;
    });
}
</script>
        
<!-- update the bar chart -->
<script>
$(document).on("ready", function(){
  console.log("doc loaded");



var conv = 20;
var signup = 60;

$('#dataRefresh').on('click', function() { 
// query runs here
  updateData(query1(), 20, 60);
});


});

function updateData(dau, conv, signup)
{

  // chart updated here
  console.log('trying to update data');
  $('#barOne').css("height", (dau/10000)*100+"%");
  $('#DAU h2').text(dau)
  $('#barTwo').css("height", conv+"%");
  $('#CONV h2').text(conv +"%")
  $('#barThree').css("height", signup+"%");
  $('#SIGNUPS h2').text(signup*100)
}

</script>      

</body></html>